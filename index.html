<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>âœ¨ 3D New Year Invitation</title>

  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://unpkg.com/aframe-particle-system-component@1.1.3/dist/aframe-particle-system-component.min.js"></script>

  <style>
    html, body { 
        height: 100%; margin: 0; overflow: hidden;
        font-family: Inter, system-ui, sans-serif; 
        background-color: #000; /* Start black */
    }
    
    /* Custom Loader (Renamed to avoid AR.js conflict) */
    #custom-loader { 
        position: fixed; inset: 0; z-index: 9999;
        background-color: rgba(0, 0, 0, 0.85); 
        display: flex; justify-content: center; align-items: center; 
        color: white; font-size: 1.25em; flex-direction: column; gap: 15px;
    }

    #startBtn { 
        z-index: 10000; padding: 16px 32px; font-size: 18px; 
        border-radius: 50px; cursor: pointer; border: none;
        background: linear-gradient(90deg, #ff6b6b, #ffd166); 
        color: #111; font-weight: bold;
        box-shadow: 0 0 25px rgba(255, 107, 107, 0.6);
        /* Hide button initially */
        display: none; 
    }

    /* UI LAYOUT */
    #ui { position: absolute; top: 12px; left: 12px; z-index: 10; pointer-events: none; }
    .panel { background: rgba(0,0,0,0.6); color: #fff; padding: 12px; border-radius: 12px; backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.1); }
    .title { font-weight: 700; margin-bottom: 4px; }
    .sub { font-size: 12px; opacity: 0.8; }

    #rsvpBtn { position: absolute; bottom: 20px; right: 20px; z-index: 11; }
    .btn { background: #ffd166; color: #000; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }

    /* Modal Styles */
    #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 10001; align-items: center; justify-content: center; }
    #modal .content { background: #111; padding: 20px; border-radius: 10px; color: #fff; width: 300px; border: 1px solid #333; }
  </style>
</head>

<body>

  <div id="custom-loader">
    <div id="loadingText">Loading Augmented Reality...</div>
    <button id="startBtn">ðŸŽ¥ ENTER EXPERIENCE</button>
  </div>

  <div id="ui">
    <div class="panel">
      <div class="title">ðŸŽ‰ You're Invited!</div>
      <div class="sub">Point camera at a Hiro marker</div>
    </div>
  </div>

  <div id="rsvpBtn"><button class="btn" id="openRsvp">RSVP</button></div>

  <div id="modal">
    <div class="content">
      <h3>RSVP</h3>
      <p>See you in 2026!</p>
      <button onclick="document.getElementById('modal').style.display='none'" class="btn">Close</button>
    </div>
  </div>

  <a-scene 
    embedded
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; colorManagement: true;"
    arjs="sourceType: webcam; debugUIEnabled: false;">

    <a-assets>
      <a-asset-item id="invitationModel" src="https://raw.githack.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF-Binary/Duck.glb"></a-asset-item>
    </a-assets>

    <a-marker preset="hiro">
      <a-entity position="0 0 0" rotation="-90 0 0">
        <a-ring radius-inner="0.4" radius-outer="0.8" material="color: #ff6b6b; opacity: 0.7"></a-ring>
        <a-box position="0 0.3 0" scale="0.5 0.5 0.5" color="#ffd166" 
               animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear"></a-box>
        
        <a-entity particle-system="preset: fireworks; particleCount: 500;"></a-entity>
        
        <a-entity gltf-model="#invitationModel" scale="0.5 0.5 0.5" position="0 0.5 0" 
                  animation="property: rotation; to: 0 -360 0; loop: true; dur: 6000; easing: linear"></a-entity>
                  
        <a-text value="Happy 2026!" position="0 1.2 0.5" align="center" scale="2 2 2" color="#ffd166"></a-text>
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const loader = document.getElementById('custom-loader');
    const startBtn = document.getElementById('startBtn');
    const loadingText = document.getElementById('loadingText');
    const openRsvp = document.getElementById('openRsvp');
    const modal = document.getElementById('modal');

    // RSVP Handlers
    openRsvp.onclick = () => modal.style.display = 'flex';

    // SCENE LOADED HANDLER
    // We wait for the scene to load before showing the Start Button
    const scene = document.querySelector('a-scene');
    
    scene.addEventListener('loaded', () => {
        console.log("Scene Loaded");
        loadingText.style.display = 'none'; // Hide "Loading..."
        startBtn.style.display = 'block';   // Show "Enter"
    });

    // If 'loaded' already fired (cached), force show button
    if (scene.hasLoaded) {
        loadingText.style.display = 'none';
        startBtn.style.display = 'block';
    }

    // START BUTTON
    startBtn.addEventListener('click', () => {
        loader.style.display = 'none';
        // Trigger a resize to fix any AR.js aspect ratio bugs on load
        window.dispatchEvent(new Event('resize'));
    });
  </script>
</body>
</html>