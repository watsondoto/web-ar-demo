<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>‚ú® 2026 New Year Portal</title>

  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://unpkg.com/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>

  <style>
    /* --- VIBE: GOLD + DEEP BLUE + NEON PURPLE --- */
    body { margin: 0; overflow: hidden; background: #050510; font-family: 'Inter', sans-serif; }
    
    /* UI OVERLAY */
    #overlay {
        position: absolute; inset: 0; pointer-events: none; z-index: 10;
        display: flex; flex-direction: column; justify-content: space-between;
        padding: 20px;
    }
    
    .guide-text {
        text-align: center; color: rgba(255,255,255,0.7); 
        font-size: 14px; margin-top: 40px; text-transform: uppercase; letter-spacing: 2px;
        text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
    }

    /* HIDDEN BLESSING MODAL */
    #blessing-modal {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 80%; max-width: 300px;
        background: rgba(10, 10, 25, 0.95);
        border: 1px solid #bc13fe; box-shadow: 0 0 30px rgba(188, 19, 254, 0.4);
        padding: 30px; border-radius: 16px; text-align: center;
        opacity: 0; pointer-events: none; transition: opacity 0.5s; z-index: 20;
    }
    #blessing-modal.visible { opacity: 1; pointer-events: auto; }
    
    .magic-text {
        background: -webkit-linear-gradient(#FFD700, #ff6b6b);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        font-weight: 800; font-size: 24px; margin-bottom: 10px;
    }

    /* LOADER */
    .arjs-loader { display: flex; justify-content: center; align-items: center; background: #000; height: 100%; width: 100%; position: absolute; z-index: 9999; }
    .loader-spinner { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid #bc13fe; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>

<body>

  <div class="arjs-loader" id="loader">
    <div class="loader-spinner"></div>
  </div>

  <div id="overlay">
    <div class="guide-text">Find the Hiro Marker</div>
    <div style="text-align: center; color: #FFD700; font-size: 12px; margin-bottom: 20px; opacity: 0.6;">
        TAP for Sparks ‚Ä¢ SHAKE for Pulse ‚Ä¢ LONG PRESS for Secret
    </div>
  </div>

  <div id="blessing-modal">
    <div class="magic-text">üçÄ LUCKY 2026</div>
    <p style="color: #ddd; font-size: 14px; line-height: 1.5;">May your year be filled with unexpected joy, wealth, and endless creativity.</p>
    <button onclick="closeBlessing()" style="margin-top:15px; background:none; border:1px solid #555; color:#aaa; padding:5px 15px; border-radius:20px;">Close</button>
  </div>

  <audio id="sfx-whoosh" preload="auto"></audio>
  <audio id="sfx-tick" preload="auto"></audio>
  <audio id="sfx-boom" preload="auto"></audio>

  <a-scene 
    embedded 
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true; colorManagement: true;"
    arjs="sourceType: webcam; debugUIEnabled: false;">

    <a-assets>
        <img id="crack-tex" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2BkQAKMQAJHgHgQAABGwAB52y8Q4AAAAABJRU5ErkJggg=="> </a-assets>

    <a-entity light="type: ambient; color: #101030; intensity: 0.5"></a-entity>
    <a-entity light="type: directional; color: #FFD700; intensity: 1.5" position="-1 4 2"></a-entity>
    <a-entity light="type: point; color: #bc13fe; intensity: 0; distance: 5" position="0 0.5 0" id="portal-light"></a-entity>

    <a-marker preset="hiro" id="main-marker">
      <a-entity id="stage-root" scale="0 0 0"> <a-entity id="stage1-group">
            <a-image src="#crack-tex" rotation="-90 0 0" scale="3 3 1" opacity="0" id="ground-cracks"
                     animation="property: opacity; to: 0.8; dur: 2000; startEvents: start-cracks"></a-image>
            
            <a-ring radius-inner="0.9" radius-outer="1.0" rotation="-90 0 0" color="#bc13fe" opacity="0" id="portal-ring-1"
                    material="shader: flat; transparent: true; blending: additive"
                    animation="property: rotation; to: -90 360 0; dur: 3000; loop: true; easing: linear"
                    animation__fade="property: opacity; to: 1; dur: 1000; startEvents: start-portal"></a-ring>
            
            <a-ring radius-inner="1.1" radius-outer="1.15" rotation="-90 0 0" color="#00f3ff" opacity="0" id="portal-ring-2"
                    material="shader: flat; transparent: true; blending: additive"
                    animation="property: rotation; to: -90 -360 0; dur: 5000; loop: true; easing: linear"
                    animation__fade="property: opacity; to: 0.6; dur: 1500; startEvents: start-portal"></a-ring>
        </a-entity>

        <a-entity position="0 1.5 0" id="stage2-group">
            <a-text value="" align="center" width="10" color="#FFD700" 
                    font="https://cdn.aframe.io/fonts/Exo2Bold.fnt" shader="msdf" id="countdown-text"
                    scale="0 0 0"></a-text>
        </a-entity>

        <a-entity id="stage3-group" visible="false">
            <a-text value="2026" align="center" width="12" position="0 1.5 0" color="#fff"
                    font="https://cdn.aframe.io/fonts/Exo2Bold.fnt" shader="msdf"
                    animation="property: position; dir: alternate; to: 0 1.7 0; dur: 2000; loop: true"></a-text>
            
            <a-plane position="0 1.5 -0.1" width="3" height="1" color="#bc13fe" 
                     material="shader: flat; opacity: 0.3; transparent: true; blending: additive"
                     animation="property: scale; dir: alternate; to: 1.2 1.2 1; dur: 500; loop: true"></a-plane>
        </a-entity>

        <a-entity id="stage4-group" position="0 0.5 0.5" visible="false">
            <a-text value="Your New Chapter\nStarts Now" align="center" width="4" color="#00f3ff"
                    opacity="0" animation="property: opacity; to: 1; dur: 2000; delay: 500"></a-text>
        </a-entity>

        <a-entity id="particle-system"></a-entity>

      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // --- VARIABLES ---
    const marker = document.getElementById('main-marker');
    const stageRoot = document.getElementById('stage-root');
    const particleSys = document.getElementById('particle-system');
    const loader = document.getElementById('loader');
    
    // Audio Refs (Simulated)
    const audioWhoosh = document.getElementById('sfx-whoosh');
    const audioTick = document.getElementById('sfx-tick');
    
    let hasStarted = false;

    // --- INITIALIZATION ---
    window.addEventListener('load', () => {
        setTimeout(() => { loader.style.display = 'none'; }, 1000);
    });

    marker.addEventListener('markerFound', () => {
        if (!hasStarted) {
            hasStarted = true;
            runSequence();
        }
        // Snap scale up
        stageRoot.setAttribute('animation', 'property: scale; to: 1 1 1; dur: 1000; easing: easeOutElastic');
    });

    marker.addEventListener('markerLost', () => {
        // Optional: Pause logic or reset
    });

    // --- SEQUENCER ---
    function runSequence() {
        console.log("üé¨ DIRECTOR: Action!");

        // STAGE 1: PORTAL (0s)
        document.getElementById('ground-cracks').emit('start-cracks');
        document.getElementById('portal-ring-1').emit('start-portal');
        document.getElementById('portal-ring-2').emit('start-portal');
        
        // Pulse Light
        const light = document.getElementById('portal-light');
        light.setAttribute('animation', 'property: intensity; to: 2; dur: 2000; easing: easeInQuad');
        
        // playSound(audioWhoosh);

        // STAGE 2: COUNTDOWN (Starts at 3s)
        setTimeout(() => {
            startCountdown(10);
        }, 3000);
    }

    function startCountdown(num) {
        const textEl = document.getElementById('countdown-text');
        
        let count = num;
        
        const interval = setInterval(() => {
            if (count > 0) {
                // Update Text
                textEl.setAttribute('value', count);
                // Pop Animation
                textEl.setAttribute('scale', '1 1 1');
                textEl.setAttribute('animation', 'property: scale; from: 2 2 2; to: 1 1 1; dur: 300; easing: easeOutBack');
                
                // Sparkle Burst
                spawnParticles(0, 1.5, 0, '#FFD700', 5);
                // playSound(audioTick);
                
                count--;
            } else {
                clearInterval(interval);
                triggerReveal();
            }
        }, 1000); // 1 second beat
    }

    // STAGE 3 & 4: REVEAL
    function triggerReveal() {
        // Hide Countdown
        document.getElementById('stage2-group').setAttribute('visible', 'false');

        // Show 2026
        const s3 = document.getElementById('stage3-group');
        s3.setAttribute('visible', 'true');
        s3.setAttribute('animation', 'property: scale; from: 0 0 0; to: 1 1 1; dur: 1500; easing: easeOutElastic');

        // Massive Fireworks
        let fwCount = 0;
        const fwInterval = setInterval(() => {
            spawnParticles((Math.random()-0.5)*2, 2 + Math.random(), (Math.random()-0.5)*2, getRandomColor(), 15);
            fwCount++;
            if(fwCount > 10) clearInterval(fwInterval); // Stop auto-fireworks after 10 bursts
        }, 600);

        // Start Confetti Rain
        startConfetti();

        // Show Message (Stage 4)
        setTimeout(() => {
            document.getElementById('stage4-group').setAttribute('visible', 'true');
        }, 2000);
    }

    // --- INTERACTION FEATURES ---

    // 1. TAP for FIREWORKS
    document.addEventListener('click', (e) => {
        // Only trigger if experience has started
        if(hasStarted) {
            spawnParticles((Math.random()-0.5), 1.5, (Math.random()-0.5), getRandomColor(), 10);
        }
    });

    // 2. SHAKE DETECTION (Simple Accelerometer)
    let lastX, lastY, lastZ;
    let lastUpdate = 0;
    const SHAKE_THRESHOLD = 15;

    window.addEventListener('devicemotion', (event) => {
        const current = event.accelerationIncludingGravity;
        if(!current) return;
        
        const time = new Date().getTime();
        if ((time - lastUpdate) > 100) {
            const diffTime = time - lastUpdate;
            lastUpdate = time;

            const speed = Math.abs(current.x + current.y + current.z - lastX - lastY - lastZ) / diffTime * 10000;

            if (speed > SHAKE_THRESHOLD) {
                // SHAKE DETECTED -> Pulse Portal
                const r1 = document.getElementById('portal-ring-1');
                if(r1) r1.setAttribute('color', '#fff');
                setTimeout(() => { if(r1) r1.setAttribute('color', '#bc13fe'); }, 300);
            }

            lastX = current.x;
            lastY = current.y;
            lastZ = current.z;
        }
    });

    // 3. LONG PRESS for SECRET BLESSING
    let pressTimer;
    document.addEventListener('touchstart', () => {
        pressTimer = setTimeout(() => {
            document.getElementById('blessing-modal').classList.add('visible');
        }, 1000); // 1 second hold
    });
    document.addEventListener('touchend', () => {
        clearTimeout(pressTimer);
    });

    function closeBlessing() {
        document.getElementById('blessing-modal').classList.remove('visible');
    }

    // --- UTILS: PARTICLE ENGINE ---
    function spawnParticles(x, y, z, color, count) {
        for(let i=0; i<count; i++) {
            const p = document.createElement('a-plane');
            p.setAttribute('position', `${x} ${y} ${z}`);
            p.setAttribute('scale', '0.05 0.05 0.05');
            p.setAttribute('color', color);
            p.setAttribute('material', 'shader: flat; side: double');
            
            // Random Velocity
            const vx = (Math.random() - 0.5) * 2;
            const vy = (Math.random() - 0.5) * 2;
            const vz = (Math.random() - 0.5) * 2;
            
            p.setAttribute('animation__pos', `property: position; to: ${x+vx} ${y+vy} ${z+vz}; dur: 1000; easing: easeOutQuad`);
            p.setAttribute('animation__fade', `property: opacity; from: 1; to: 0; dur: 1000`);
            
            particleSys.appendChild(p);
            
            setTimeout(() => { particleSys.removeChild(p); }, 1000);
        }
    }

    function startConfetti() {
        setInterval(() => {
            const p = document.createElement('a-plane');
            const x = (Math.random() - 0.5) * 2;
            const z = (Math.random() - 0.5) * 2;
            p.setAttribute('position', `${x} 3 ${z}`); // Start high
            p.setAttribute('scale', '0.03 0.06 0.03');
            p.setAttribute('color', getRandomColor());
            p.setAttribute('rotation', `${Math.random()*360} ${Math.random()*360} 0`);
            
            // Fall animation
            p.setAttribute('animation', `property: position; to: ${x} 0 ${z}; dur: 3000; easing: linear`);
            // Spin animation
            p.setAttribute('animation__spin', `property: rotation; to: ${Math.random()*360} ${Math.random()*360} 0; dur: 3000; easing: linear`);

            particleSys.appendChild(p);
            setTimeout(() => { if(p.parentNode) p.parentNode.removeChild(p); }, 3000);
        }, 100);
    }

    function getRandomColor() {
        const colors = ['#FFD700', '#00f3ff', '#bc13fe', '#ffffff'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

  </script>
</body>
</html>
