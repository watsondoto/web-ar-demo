<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>âœ¨ 3D New Year Invitation â€” Marker AR</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <!-- AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.2/aframe/build/aframe-ar.js"></script>
  <!-- Particle system -->
  <script src="https://unpkg.com/aframe-particle-system-component@3.0.0/dist/aframe-particle-system-component.min.js"></script>

  <style>
    html, body { height:100%; margin:0; font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:#000;}
    #ui { position: absolute; left: 12px; right: 12px; top: 12px; z-index: 4; pointer-events: none; }
    .panel { pointer-events: auto; background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.25)); color: #fff; padding: 12px 14px; border-radius: 12px; backdrop-filter: blur(6px); box-shadow: 0 6px 20px rgba(0,0,0,0.45); }
    .title { font-size:18px; font-weight:600; margin-bottom:6px; }
    .sub { font-size:13px; color: #f0e6ff; opacity:0.95 }
    #rsvpBtn { position: absolute; right: 18px; bottom: 18px; z-index:5; pointer-events:auto; }
    .btn { background: linear-gradient(90deg,#ff6b6b,#ffd166); color:#111; border:none; padding:12px 18px; font-weight:700; border-radius:999px; box-shadow: 0 8px 30px rgba(255,107,107,0.18); cursor:pointer; }
    #modal { position: fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:10; }
    #modal .content { width: min(520px, 92%); background: #0b1020; border-radius:14px; padding:18px; box-shadow: 0 20px 60px rgba(2,6,23,0.7); color:#e8eaf6 }
    #closeModal { float:right; background:transparent; border:none; color:#bbb; font-size:18px }
    #hint { position:absolute; left:12px; bottom: 18px; z-index:5; color:#fff; font-size:12px; opacity:0.95; }
    #startBtn { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); padding:20px 28px; font-size:18px; border-radius:12px; cursor:pointer; background:linear-gradient(90deg,#ff6b6b,#ffd166); color:#111; z-index:20; }
    a-scene { width:100vw; height:100vh; }
  </style>
</head>
<body>

  <div id="ui">
    <div class="panel">
      <div class="title">ðŸŽ† You're Invited â€” New Year Celebration</div>
      <div class="sub">Point your camera at the marker to reveal the 3D invitation. Tap the RSVP button to respond.</div>
    </div>
  </div>

  <div id="rsvpBtn">
    <button class="btn" id="openRsvp">RSVP</button>
  </div>

  <div id="hint">Tip: Use a printed marker (Hiro or custom) for best tracking.</div>

  <div id="modal">
    <div class="content">
      <button id="closeModal">âœ•</button>
      <h2 style="margin-top:6px">RSVP â€” Happy New Year!</h2>
      <p>We'd love to celebrate with you on <strong>January 1, 2026</strong> at <strong>20:00</strong> â€” Venue: <em>Your Festive Hall</em>.</p>
      <form id="rsvpForm">
        <label style="display:block; margin-top:8px">Your name</label>
        <input type="text" name="name" required style="width:100%; padding:10px; border-radius:8px; border:1px solid #2b3350; background:#07102a; color:#fff;" />
        <label style="display:block; margin-top:8px">Attending?</label>
        <select name="attending" style="width:100%; padding:10px; border-radius:8px; border:1px solid #2b3350; background:#07102a; color:#fff;">
          <option value="yes">Yes â€” see you there ðŸŽ‰</option>
          <option value="no">No â€” send my wishes âœ¨</option>
        </select>
        <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end">
          <button type="button" id="cancel" style="padding:10px 14px; border-radius:8px; background:transparent; color:#fff; border:1px solid #2b3350">Cancel</button>
          <button type="submit" class="btn">Send RSVP</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Start button for mobile autoplay -->
  <button id="startBtn">ðŸŽ¥ Start AR Experience</button>

  <a-scene embedded vr-mode-ui="enabled: false" arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-assets>
      <a-asset-item id="invitationModel" src="https://cdn.jsdelivr.net/gh/yourusername/assets/newyear-invitation.glb"></a-asset-item>
      <a-asset-item id="fireworksModel" src="https://cdn.jsdelivr.net/gh/yourusername/assets/fireworks.glb"></a-asset-item>
      <audio id="bgm" src="https://cdn.jsdelivr.net/gh/yourusername/assets/newyear-loop.mp3" preload="auto" crossorigin="anonymous"></audio>
    </a-assets>

    <a-entity camera></a-entity>

    <a-marker preset="hiro" id="invMarker">
      <a-entity id="cardRoot" position="0 0 0" rotation="-90 0 0">
        <a-ring radius-inner="0.06" radius-outer="0.2" position="0 0.02 0" rotation="-90 0 0" material="shader: standard; emissive: #ffd6a5; emissiveIntensity: 0.25; opacity:0.9"></a-ring>
        <a-entity id="gltfInv" gltf-model="#invitationModel" scale="0.25 0.25 0.25" position="0 0.03 0" visible="false" animation__pop="property: scale; from: 0 0 0; to: 0.25 0.25 0.25; dur: 700; easing: easeOutElastic"></a-entity>
        <a-entity id="fireworks" gltf-model="#fireworksModel" scale="0.6 0.6 0.6" position="0 0.35 -0.2" visible="false"></a-entity>
        <a-entity id="confetti" particle-system="preset: dust; particleCount: 2400; size: 0.02; maxAge: 3; color: #ff6b6b, #ffd166, #9b5de5, #00bbf9; opacity: 0.95" position="0 0.4 0" visible="false"></a-entity>
        <a-entity id="titleText" position="0 0.7 0" rotation="-40 0 0" visible="false">
          <a-text value="Happy New Year 2026" align="center" width="2.6" color="#fff" shader="msdf" font="https://cdn.aframe.io/fonts/mozillavr.fnt"></a-text>
        </a-entity>
      </a-entity>
    </a-marker>

    <a-entity light="type: ambient; intensity: 0.8"></a-entity>
    <a-entity light="type: directional; intensity: 1.2" position="0 4 2"></a-entity>
  </a-scene>

  <script>
    const startBtn = document.getElementById('startBtn');
    const openRsvp = document.getElementById('openRsvp');
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const cancel = document.getElementById('cancel');
    const form = document.getElementById('rsvpForm');

    const marker = document.querySelector('#invMarker');
    const invModel = document.querySelector('#gltfInv');
    const fireworks = document.querySelector('#fireworks');
    const confetti = document.querySelector('#confetti');
    const titleText = document.querySelector('#titleText');
    const bgm = document.querySelector('#bgm');

    // RSVP modal
    openRsvp.addEventListener('click', ()=>{ modal.style.display = 'flex'; });
    closeModal.addEventListener('click', ()=>{ modal.style.display = 'none'; });
    cancel.addEventListener('click', ()=>{ modal.style.display = 'none'; });
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      alert('Thanks! Your RSVP was sent.');
      modal.style.display = 'none';
    });

    // Marker events
    marker.addEventListener('markerFound', ()=>{
      invModel.setAttribute('visible','true');
      fireworks.setAttribute('visible','true');
      confetti.setAttribute('visible','true');
      titleText.setAttribute('visible','true');
      tryPlayAudio();
      invModel.setAttribute('animation__float', 'property: position; dir: alternate; dur: 1600; to: 0 0.06 0; loop: true; easing: easeInOutSine');
      setTimeout(()=>{ confetti.setAttribute('visible','false'); }, 4000);
    });

    marker.addEventListener('markerLost', ()=>{
      invModel.setAttribute('visible','false');
      fireworks.setAttribute('visible','false');
      confetti.setAttribute('visible','false');
      titleText.setAttribute('visible','false');
      if(bgm){ bgm.pause(); bgm.currentTime = 0; }
    });

    // Mobile audio & camera autoplay fix
    function tryPlayAudio(){
      if(!bgm) return;
      const playPromise = bgm.play();
      if(playPromise !== undefined){
        playPromise.catch(()=>{
          const handler = ()=>{ bgm.play().catch(()=>{}); window.removeEventListener('touchstart', handler); };
          window.addEventListener('touchstart', handler, { once: true });
        });
      }
    }

    // Start AR on button click
    startBtn.addEventListener('click', ()=>{
      startBtn.style.display = 'none';
      tryPlayAudio();
      // restart A-Frame scene for mobile autoplay
      const scene = document.querySelector('a-scene');
      scene.systems.arjs.arSource.init(() => {});
    });
  </script>
</body>
</html>

