<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Markerless WebAR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #start-button {
        padding: 20px 40px;
        font-size: 18px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
      }
      #instructions {
        color: white;
        text-align: center;
        padding: 20px;
        max-width: 80%;
      }
      #info {
        position: fixed;
        top: 10px;
        left: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 15px;
        border-radius: 8px;
        z-index: 9998;
        font-size: 14px;
      }
      .hidden {
        display: none !important;
      }
      #video {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
      }
      #canvas3d {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
      }
      #tapIndicator {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(76, 175, 80, 0.8);
        color: white;
        padding: 20px 30px;
        border-radius: 50px;
        font-size: 16px;
        z-index: 9997;
        pointer-events: none;
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0%, 100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
        50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
      }
    </style>
  </head>
  <body>
    <div id="overlay">
      <div id="instructions">
        <h2>ðŸŽ­ Markerless AR</h2>
        <p>No markers needed! Just tap on any flat surface to place a dancing 3D character</p>
      </div>
      <button id="start-button">Start AR</button>
    </div>

    <div id="info" class="hidden">
      <strong>ðŸ‘† Tap anywhere</strong> on a flat surface (table, floor, paper) to place your 3D model
    </div>

    <div id="tapIndicator" class="hidden">ðŸ‘† Tap to Place</div>

    <video id="video" playsinline autoplay muted class="hidden"></video>
    <canvas id="canvas3d" class="hidden"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas3d');
      const overlay = document.getElementById('overlay');
      const info = document.getElementById('info');
      const tapIndicator = document.getElementById('tapIndicator');
      
      let scene, camera, renderer, character, particles = [];
      let isARActive = false;

      document.getElementById('start-button').addEventListener('click', async function() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { 
              facingMode: 'environment',
              width: { ideal: 1280 },
              height: { ideal: 720 }
            } 
          });
          
          video.srcObject = stream;
          await video.play();
          
          overlay.classList.add('hidden');
          video.classList.remove('hidden');
          canvas.classList.remove('hidden');
          info.classList.remove('hidden');
          tapIndicator.classList.remove('hidden');
          
          initThreeJS();
          
        } catch (error) {
          alert('Camera error: ' + error.message);
        }
      });

      function initThreeJS() {
        scene = new THREE.Scene();
        
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;
        
        renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        
        // Add lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 5);
        scene.add(directionalLight);
        
        isARActive = true;
        animate();
      }

      function createDancingCharacter(x, y) {
        // Remove previous character
        if (character) {
          scene.remove(character);
        }
        
        // Create a simple humanoid character
        character = new THREE.Group();
        
        // Body
        const bodyGeometry = new THREE.CylinderGeometry(0.3, 0.4, 1, 8);
        const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0x4CAF50 });
        const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
        body.position.y = 0.5;
        character.add(body);
        
        // Head
        const headGeometry = new THREE.SphereGeometry(0.3, 16, 16);
        const headMaterial = new THREE.MeshPhongMaterial({ color: 0xFFD700 });
        const head = new THREE.Mesh(headGeometry, headMaterial);
        head.position.y = 1.3;
        character.add(head);
        
        // Eyes
        const eyeGeometry = new THREE.SphereGeometry(0.08, 8, 8);
        const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });
        const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
        leftEye.position.set(-0.12, 1.35, 0.25);
        character.add(leftEye);
        const rightEye = leftEye.clone();
        rightEye.position.x = 0.12;
        character.add(rightEye);
        
        // Arms
        const armGeometry = new THREE.CylinderGeometry(0.1, 0.08, 0.8, 8);
        const armMaterial = new THREE.MeshPhongMaterial({ color: 0x4CAF50 });
        const leftArm = new THREE.Mesh(armGeometry, armMaterial);
        leftArm.position.set(-0.5, 0.5, 0);
        leftArm.rotation.z = 0.3;
        character.add(leftArm);
        const rightArm = leftArm.clone();
        rightArm.position.x = 0.5;
        rightArm.rotation.z = -0.3;
        character.add(rightArm);
        
        // Legs
        const legGeometry = new THREE.CylinderGeometry(0.12, 0.1, 0.8, 8);
        const legMaterial = new THREE.MeshPhongMaterial({ color: 0x2196F3 });
        const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
        leftLeg.position.set(-0.2, -0.4, 0);
        character.add(leftLeg);
        const rightLeg = leftLeg.clone();
        rightLeg.position.x = 0.2;
        character.add(rightLeg);
        
        // Position character based on tap
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        const offsetX = (x - centerX) / 200;
        const offsetY = (centerY - y) / 200;
        
        character.position.set(offsetX, offsetY, 0);
        character.userData.startTime = Date.now();
        character.userData.leftArm = leftArm;
        character.userData.rightArm = rightArm;
        character.userData.leftLeg = leftLeg;
        character.userData.rightLeg = rightLeg;
        
        scene.add(character);
        
        // Create particle effect
        createParticles(character.position);
        
        info.innerHTML = '<strong>ðŸŽ‰ Character placed!</strong> Tap again to move it';
        setTimeout(() => {
          if (tapIndicator) tapIndicator.classList.add('hidden');
        }, 2000);
      }

      function createParticles(position) {
        const particleGeometry = new THREE.SphereGeometry(0.05, 4, 4);
        const particleMaterial = new THREE.MeshBasicMaterial({ color: 0xFFD700 });
        
        for (let i = 0; i < 20; i++) {
          const particle = new THREE.Mesh(particleGeometry, particleMaterial);
          particle.position.copy(position);
          particle.userData.velocity = new THREE.Vector3(
            (Math.random() - 0.5) * 0.1,
            Math.random() * 0.15,
            (Math.random() - 0.5) * 0.1
          );
          particle.userData.life = 1.0;
          scene.add(particle);
          particles.push(particle);
        }
      }

      function animateCharacter() {
        if (!character) return;
        
        const time = (Date.now() - character.userData.startTime) / 1000;
        
        // Dancing animation
        character.rotation.y = Math.sin(time * 2) * 0.5;
        character.position.y += Math.sin(time * 4) * 0.005;
        
        // Arm swinging
        character.userData.leftArm.rotation.z = 0.3 + Math.sin(time * 3) * 0.5;
        character.userData.rightArm.rotation.z = -0.3 - Math.sin(time * 3) * 0.5;
        
        // Leg movement
        character.userData.leftLeg.rotation.x = Math.sin(time * 3) * 0.3;
        character.userData.rightLeg.rotation.x = -Math.sin(time * 3) * 0.3;
      }

      function updateParticles() {
        particles = particles.filter(particle => {
          particle.position.add(particle.userData.velocity);
          particle.userData.velocity.y -= 0.003;
          particle.userData.life -= 0.02;
          particle.material.opacity = particle.userData.life;
          
          if (particle.userData.life <= 0) {
            scene.remove(particle);
            return false;
          }
          return true;
        });
      }

      function animate() {
        if (!isARActive) return;
        requestAnimationFrame(animate);
        
        animateCharacter();
        updateParticles();
        
        renderer.render(scene, camera);
      }

      // Tap to place
      canvas.addEventListener('click', (e) => {
        if (!isARActive) return;
        createDancingCharacter(e.clientX, e.clientY);
      });

      canvas.addEventListener('touchstart', (e) => {
        if (!isARActive) return;
        e.preventDefault();
        const touch = e.touches[0];
        createDancingCharacter(touch.clientX, touch.clientY);
      });

      // Handle resize
      window.addEventListener('resize', () => {
        if (camera && renderer) {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        }
      });
    </script>
  </body>
</html>